\documentclass[12pt,a4paper]{article}
\usepackage[warn] {mathtext}
\usepackage[cp1251]{inputenc}
\usepackage[english, russian]{babel}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{mathtools}
\usepackage{pgfplots}
\usepackage[top=2cm, bottom=2cm, marginparwidth=0pt, left=3cm, right=1.5cm]{geometry}
\usepackage[ruled]{algorithm2e}

\renewcommand\qedsymbol{$\blacksquare$}

\begin{document}

\newtheorem*{Def}{Определение}
\newtheorem*{Th}{Теорема}
\newtheorem*{Lem}{Лемма}
\newtheorem*{Note}{Замечание}
\newtheorem*{Ex}{Пример}

\newenvironment{Sol}{\textbf{Решение.\linebreak}}

\section{Метод Ритца}	
	Выделяют два основных типа методов решения вариационных задач.
	К первому типу относятся методы, сводящие исходную задачу к решению
	дифференциальных уравнений. Эти методы очень хорошо развиты и им будет
	посвящено основное время на лекциях. Альтернативой являются так называемые
	прямые методы. Эти методы тем или иным способом решают исходную задачу по
	поиску функции в заданном классе, которая доставляла бы экстремальное 
	значение заданному функционалу. Один из самых популярных методов этого класса ---
	метод Ритца (также называемый методом Рэлея-Ритца).

	В основе метода Ритца лежит построение минимизирующей последовательности функций.
	Пусть, например, необходимо найти минимум функционала $V[y]$ в классе функций $M$.
	Чтобы задача имела смысл, потребуем, чтобы существовал конечный инфимум $\mu$ значений
	функционала и в классе допустимых функций существовали функции, на которых
	функционал принимает конечные значения. Тогда по определению инфимума существует
	минимизирующая последовательность функций $y_1, y_2, \dots, y_n, \dots$ такая, что
	\[
		\lim_{n \to \infty}V[y_n] = \mu~.
	\]
	Если существует предел $y^*$ этой последовательности, она и будет решением исходной задачи,
	так как будет законен предельный переход
	\[
		V[y^*] = \lim_{n \to \infty}V[y_n]~.
	\]

	Каким же образом стоится эта минимизирующая последовательность в методе Ритца?
	Сначала изложим общую идею, а потом рассмотрим ее конкретную реализацию для одного
	типа вариационных задач. Итак, сначала необходимо выбрать некоторую систему функций,
	которую мы назовем базисной:
	\[
		\varphi_1, \varphi_2, \dots, \varphi_n, \dots~.
	\]
	К функциям $\varphi_n$ выдвигаются два требования. Во-первых, сами эти функции
	принадлежат классу $M$, а во-вторых --- любая конечная линейная комбинация этих функций
	вида
	\[
		y_n = c_1\varphi_1 + c_2\varphi_2 + \dots + c_n\varphi_n
	\]
	принадлежит тому же классу $M$. Исходная задача заменяется следующей: минимизировать
	функцию многих переменных
	\[
		\max_{c_1, \dots, c_n}V[c_1\varphi_1 + \dots + c_2\varphi_n]
	\]
	Решая эту задачу известными (из курса <<Методов оптимизации>>, например) методами,
	получаем некоторое минимальное значение $\mu_n$. Поскольку при увеличении числа слагаемых
	мы только расширяем множество функций, на котором ищется минимум, будет справедлива
	цепочка неравенств $\mu_1 \geq \mu_2 \geq \dots \mu_n \geq \mu_{n+1} \geq \dots$.
	Можно доказать, что при некоторых условиях эта последовательность значений сходится к 
	$\mu$.
	
	\begin{Th}
		Если функционал $V[y]$ непрерывен (в смысле метрики пространства, в котором он
		рассматривается) и система функций ${\varphi_n}$ полная, то 
		\[
			\lim_{n \to \infty} \mu_n = \mu~,
		\]
		где $\mu$ --- минимум функционала $V[y]$.
	\end{Th}

	\begin{Note} Быстрота сходимости метода Ритца сильно зависит от выбора
		системы базисных функций. Однако при удачном выборе для
		достижения приемлемой точности часто бывает достаточно 3-4
		слагаемых в линейной комбинации.
	\end{Note}

	Применим изложенную идею к достаточно часто встречающейся вариационной задаче.
	Итак, пусть необходимо минимизировать значение функционала
	\[
		V[y] = \int\limits_0^1{\left[p(x)\left(y'(x)\right)^2 + q(x)y^2(x) - 2f(x)y(x)\right]}dx
	\]
	на множестве функций $M = \left\{y(x)\,\, |\,\, y(x) \in C^2_{[0,1]},\,\, y(0)=y(1)=0 \right\}$.
	Зафиксируем теперь некоторую конечную систему линейно-независимых
	функций $\left\{\varphi_i\right\}_{i=1}^n$, которые удовлетворяют
	однородным краевым условиям
	\[
		\varphi_i(0) = \varphi_i(1) = 0,\quad i = \overline{1,n}~.
	\]
	Вместо исходной задачи будем решать значительно более узкую задачу
	минимизации функционала на множестве линейных комбинаций
	$$\varphi(x) = \sum_{i=1}^nc_i\varphi_i(x)~.$$
	Подставим эту линейную комбинацию в функционал:
	\begin{align*}
		V[\varphi(x)]& = V\left[\sum_{i=1}^n{c_i\varphi_i(x)}\right] = \\
			     & = \int\limits_0^1 \left\{
			     p(x)\left[\sum_{i=1}^n{c_i\varphi'_i(x)}\right]^2 +
			     q(x)\left[\sum_{i=1}^n{c_i\varphi_i(x)}\right]^2 -
			     2f(x)\sum_{i=1}^n{c_i\varphi_i(x)}
			     \right\}dx~.
	\end{align*}
	Чтобы найти минимум функционала, воспользуемся необходимым условием
	экстремума:
	\[	
		\frac{\partial V}{\partial c_j} = 0, \quad j = \overline{1,n}
	\]
	Дифференцирование функционала по $c_j$ дает
	\[
		\frac{\partial V}{\partial c_j} = 
		     \int\limits_0^1\left\{
			     2p(x)\sum_{i=1}^n{c_i\varphi'_i(x)\varphi'_j(x)} +
			     2q(x)\sum_{i=1}^n{c_i\varphi_i(x)\varphi_j(x)} -
			     2f(x)\varphi_j(x)
		     \right\}dx~.
	\]
	После очевидных преобразований получаем систему линейных алгебраических
	уравнений для нахождения коэффициентов линейной комбинации:
	\[
		\sum_{i=1}^n\left[
			\int\limits_0^1\left(p(x)\varphi'_i(x)\varphi'_j(x) + 
			q(x)\varphi_i(x)\varphi_j(x)\right)dx
		\right]c_i 
		- \int\limits_0^1{f(x)\varphi_j(x)}dx = 0, \quad j =
		\overline{1,n}
	\]
	В матричной форме эта система запишется в виде $Ac=b$, где
	\begin{gather*}
		a_{ij} = \int\limits_0^1\left(p(x)\varphi'_i(x)\varphi'_j(x) + 
			q(x)\varphi_i(x)\varphi_j(x)\right)dx,	\\
		b_j = \int\limits_0^1{f(x)\varphi_j(x)}dx
	\end{gather*}

	Рассмотрим теперь вопрос выбора базисных функций.
\subsection{Кусочно-линейный базис}
	Простейшим вариантом выбора базиса является система кусочно-линейных функций.
	Чтобы ее построить, необходимо вначале задать разбиение отрезка $[0, 1]$ на $n$ отрезков:
	\[
		0 = x_0 < x_1 < \dots < x_n < x_{n+1} = 1~.
	\]
	Полагая $h_i = x_{i+1} - x_i$, определим следующие функции:
	\[
		\varphi_i(x) = 
		\begin{cases}
			0, & \text{если} \quad 0 \leq x \leq x_{i-1}, \\
			\frac{1}{h_{i-1}}\left(x-x_{i-1}\right), & \text{если} \quad x_{i-1} < x \leq x_{i}, \\
			\frac{1}{h_i}\left(x_{i+1}-x\right), & \text{если} \quad x_i < x \leq x_{i+1}, \\
			0, & \text{если} \quad x_{i+1} < x < 1~.
		\end{cases},\quad i = \overline{1,n}
	\]
	Ниже на рисунке приведены схематические графики этих базисных функций.
	\begin{center}
	\begin{tikzpicture}
		\pgfplotsset{every axis plot/.append style={line width=1.5pt}}
		\begin{axis}[
			width=4cm, scale only axis,
			xlabel=x,
			ylabel=y,
			xtick=\empty,
			ytick={0,1},
			xtick={0,1},
			extra x ticks={0.333, 0.5},
			extra x tick labels={$x_1$, $x_2$},
			axis x line=middle,
			axis y line=middle]
			\addplot[] coordinates {
			(0.0, 	0.0)
			(0.333, 1.0)
			(0.5,	0.0)
			(1.0,	0.0)
			};
		\draw (3cm,3cm) node {$y=\varphi_1(x)$};
		\end{axis}
	\end{tikzpicture}
	\begin{tikzpicture}
		\pgfplotsset{every axis plot/.append style={line width=1.5pt}}
		\begin{axis}[
			width=4cm, scale only axis,
			xlabel=x,
			ylabel=y,
			xtick=\empty,
			ytick={0,1},
			xtick={0,1},
			extra x ticks={0.2, 0.4, 0.75},
			extra x tick labels={$x_{i-1}$, $x_i$, $x_{i+1}$},
			axis x line=middle,
			axis y line=middle]
			\addplot[] coordinates {
			(0.0, 	0.0)
			(0.2,	0.0)
			(0.4,	1.0)
			(0.75,	0.0)
			(1.0,	0.0)
			};
		\draw (3cm,3cm) node {$y=\varphi_i(x)$};
		\end{axis}
	\end{tikzpicture}
	\begin{tikzpicture}
		\pgfplotsset{every axis plot/.append style={line width=1.5pt}}
		\begin{axis}[
			width=4cm, scale only axis,
			xlabel=x,
			ylabel=y,
			xtick=\empty,
			ytick={0,1},
			extra x ticks={0.2, 0.4, 0.75},
			extra x tick labels={$x_{n-1}$, $x_n$, $1$},
			axis x line=middle,
			axis y line=middle]
			\addplot[] coordinates {
			(0.0, 	0.0)
			(0.2,	0.0)
			(0.4,	1.0)
			(0.75,	0.0)
			(1.0,	0.0)
			};
		\draw (3cm,3cm) node {$y=\varphi_n(x)$};
		\end{axis}
	\end{tikzpicture}
	\end{center}
	Производные базисных функций будут кусочно-постоянными функциями и их
	нетрудно найти:
	\[
	\varphi'_i(x) = 
		\begin{cases}
			0, & \text{если} \quad 0 \leq x \leq x_{i-1}, \\
			\frac{1}{h_{i-1}}, & \text{если} \quad x_{i-1} < x \leq x_{i}, \\
			-\frac{1}{h_i}, & \text{если} \quad x_i < x \leq x_{i+1}, \\
			0, & \text{если} \quad x_{i+1} < x < 1~.
		\end{cases},\quad i = \overline{1,n}
	\]
	Поскольку $i$-ая функция отлична от нуля только на промежутке 
	$(x_{i-1},x_{i+1}]$, то справедливы равенства
	\[
		\varphi_i(x)\varphi_j(x) = 0 \quad\text{и}\quad 
		\varphi'_i(x)\varphi'_j(x) = 0, \quad i,j = \overline{1,n}, 
		\quad j\neq{i-1}, j \neq i, j \neq {i+1}.
	\]
	Последнее означает, что матрица системы уравнений для $c_j$ при таком
	выборе базисных функций будет трехдиагональной. А именно, ненулевыми
	будут элементы:
	\begin{align*}
		a_{i,i+1}& = \int\limits_0^1\left[
				p(x)\varphi'_i(x)\varphi'_{i+1}(x) + 
				q(x)\varphi_i(x)\varphi_{i+1}(x)
				\right]dx = \\
			 & = -\left(\frac{1}{h_i}\right)^2
				\int\limits_{x_i}^{x_{i+1}}p(x)dx + 
				\underbrace{\left(\frac{1}{h_i}\right)^2
				\int\limits_{x_i}^{x_{i+1}}{\left(x_{i+1}-x\right)\left(x-x_i\right)q(x)}dx}_
				{\displaystyle I_{1,i}}~,\quad i = \overline{1,n-1}~.
	\end{align*}
	\begin{align*}
		a_{ii}& = \int\limits_0^1\left[
			p(x)\left(\varphi'_i(x)\right)^2 + 
			q(x)\varphi_i^2(x)\right]dx = \\
		      & = \left(\frac{1}{h_{i-1}}\right)^2
				\int\limits_{x_{i-1}}^{x_i}p(x)dx + 
				\left(\frac{1}{h_i}\right)^2
				\int\limits_{x_i}^{x_{i+1}}p(x)dx + \\
		      & + \underbrace{\left(\frac{1}{h_{i-1}}\right)^2
		      	\int\limits_{x_{i-1}}^{x_i}{\left(x-x_{i-1}\right)^2q(x)}dx}_
			{\displaystyle I_{2,i}} +
			  \underbrace{\left(\frac{1}{h_i}\right)^2
			\int\limits_{x_i}^{x_{i+1}}{\left(x_{i+1}-x\right)^2q(x)}dx}_
			{\displaystyle I_{3,i}}~, \quad i = \overline{1,n}~,
	\end{align*}
	\begin{align*}
		a_{i,i-1}& = \int\limits_0^1\left[
				p(x)\varphi'_i(x)\varphi'_{i-1}(x) + 
				q(x)\varphi_i(x)\varphi_{i-1}(x)
				\right]dx = \\
			 & = - \underbrace{\left(\frac{1}{h_{i-1}}\right)^2
				\int\limits_{x_{i-1}}^{x_i}p(x)dx}_{\displaystyle
				I_{4,i}}+ 
				\left(\frac{1}{h_{i-1}}\right)^2
				\int\limits_{x_{i-1}}^{x_i}{\left(x_i-x\right)\left(x-x_{i-1}\right)q(x)}dx~, 
				\quad i = \overline{2,n}~,
	\end{align*}

	Столбец правых частей будет состоять из элементов вида
	\[
		b_i = \int\limits_0^1{f(x)\varphi_i(x)}dx = 
		\underbrace{\frac{1}{h_{i-1}}
			\int\limits_{x_{i-1}}^{x_i}\left(x-x_{i-1}\right)f(x)dx}_{\displaystyle	I_{5,i}}
		+
		\underbrace{\frac{1}{h_i}
			\int\limits_{x_i}^{x_{i+1}}\left(x_{i+1}-x\right)f(x)dx}_{\displaystyle I_{6,i}},
		\quad i=\overline{1,n}~.
	\]
	Используя введенные выше обозначения для некоторых интегралов, эти же
	выражения можно кратко записать следующим образом:
	\begin{align*}
		a_{ii}& 	= I_{4,i} + I_{4,i+1} + I_{2,i} + I_{3,i}, \quad
							i = \overline{2,n}, \\
		a_{i,i+1}&	= -I_{4,i+1} + I_{1,i}, \quad i =
							\overline{1,n-1}, \\
		a_{i,i-1}&	= -I_{4,i} + I_{1, i-1}, \quad i=\overline{2,n}, \\
		b_i&		= I_{5,i} + I_{6,i}, \quad i = \overline{1,n}~.
	\end{align*}
	Итак, чтобы построить трехдиагональную систему линейных уравнений,
	необходимо вычислить $6n$ интегралов. Для некоторых задач это можно
	сделать аналитически, но чаще приходится прибегать к численным методам
	интегрирования (например, можно использовать правило Симпсона, см. Приложение).

	Запишем теперь формальный алгоритм метода Ритца с кусочно-линейным
	базисом.

	\pagebreak
	\begin{algorithm}[H]
		\DontPrintSemicolon
		\NoCaptionOfAlgo
		\SetKwInOut{Input}{ВХОД} 
		\SetKwInOut{Output}{ВЫХОД}
		\SetKwInOut{KwPrint}{ВЫВЕСТИ}

		\Input{Целое число $n \geq 1$; точки $x_0=0<x_1< 
				\dots <x_n<x_{n+1}=1$.}
		\BlankLine
		\Output{Коэффициенты $c_1, \dots, c_n$.}
		\BlankLine
		\nlset{ШАГ 1} 	\For{$i \leftarrow 0$ \KwTo $n$}{
					$h_i \leftarrow x_{i+1}-x_i$
				}
		\nlset{ШАГ 2} \For{$i \leftarrow 1$ \KwTo $n$}{
					Определяем базисные функции $\varphi_i$:
					$ \displaystyle \varphi_i(x) = 
					\begin{cases}
						0, & \text{если} \quad 0 \leq x \leq x_{i-1}, \\
						\frac{1}{h_{i-1}}\left(x-x_{i-1}\right), & 
							\text{если} \quad x_{i-1} < x \leq x_{i}, \\
						\frac{1}{h_i}\left(x_{i+1}-x\right), & 
							\text{если} \quad x_i < x \leq x_{i+1}, \\
						0, & \text{если} \quad x_{i+1} < x < 1~.
					\end{cases}$
				}
		\nlset{ШАГ 3} \For{$i \leftarrow 1$ \KwTo $n-1$}{
					Вычисляем $I_{1,i}, I_{2,i}, I_{3,i},I_{4,i}, I_{5,i}, I_{6,i}$.
				}
				Вычисляем $I_{2,n},I_{3,n},I_{4,n},I_{4,n+1},I_{5,n},I_{6,n}$. \;
		\nlset{ШАГ 4} \For{$i \leftarrow 1$ \KwTo $n-1$}{
				$\alpha_i \leftarrow I_{4,i} + I_{4,i+1} + I_{2,i} + I_{3,i}$ \;
				$\beta_i \leftarrow I_{1,i}-I_{4,i+1}$ \;
				$b_i \leftarrow I_{5,i} + I_{6,i}$ \;	
				}
		\nlset{ШАГ 5} Вычисляем \;
				\Indp {$\alpha_n \leftarrow I_{4,n}+I_{4,n+1}+I_{2,n}+I_{3,n}$ \;
				$b_n \leftarrow I_{5,n}+I_{6,n}$ \;}
				\Indm
		\nlset{ШАГ 6} Начинаем решать трехдиагональную систему уравнений (шаги 6-10) \;
				\Indp {
					$a_1 \leftarrow \alpha_1$ \;
					$\displaystyle \zeta_1 \leftarrow \frac{\beta_1}{\alpha_1}$ \;
					$\displaystyle z_1 \leftarrow \frac{b_1}{a_1}$ \;
				}
				\Indm
		\nlset{ШАГ 7} \For{$i \leftarrow 2$ \KwTo $n-1$}{
				\Indp {
					$a_i \leftarrow \alpha_i - \beta_{i-1}\zeta_{i-1}$ \;
					$\displaystyle \zeta_i \leftarrow \frac{\beta_i}{a_i}$ \;
					$\displaystyle z_i \leftarrow \frac{b_i
					- \beta_{i-1}z_{i-1}}{a_i}$ \;
				}
				\Indm
				}
		\nlset{ШАГ 8} Вычисляем \;
				\Indp { $a_n \leftarrow \alpha_n - \beta_{n-1}\zeta_{n-1}$ \;
					$\displaystyle z_n \leftarrow	\frac{b_n-\beta_{n-1}z_{n-1}}{a_n}$ \;
				} 
				\Indm
		\nlset{ШАГ 9} Полагаем $c_n \leftarrow z_n$ \;
				\KwPrint{$c_n$} 
		\nlset{ШАГ 10} \For{$i \leftarrow n-1$ \KwTo $1$}{
				\Indp 	{$c_i \leftarrow z_i - \zeta_ic_{i+1}$ \;
					\KwPrint{$c_i$}
					} \Indm
				} 
		\nlset{ШАГ 11} Процедура окончена.				

		\caption{\Large Кусочно-линейный метод Ритца}
	\end{algorithm}
	%\pagebreak

	Рассмотрим пример использования метода Ритца, в котором интегралы
	(шаги 3, 4 и 5) находятся в явном виде.
	\begin{Ex}
		Пусть необходимо минимизировать функционал
		\[
			V[y] = \int\limits_0^1{\left(\left[y'(x)\right]^2 +
			\pi^2y^2(x) - 4\pi^2\sin{\pi x}\right)}dx\,,
		\]
		на множестве $C^2_{[0,1]}$ при заданных граничных условиях $y(0) = y(1) = 0$. 
	\end{Ex}
	\begin{Sol}
		Положим $h_i = h = 0.1$, то есть $x_i = 0.1i,\,i =
		\overline{0,9}$. Вычислим интегралы:
		\begin{align*}
			I_{1,i}& = 100\int\limits_{0.1i}^{0.1i+0.1}{
				\left(0.1i+0.1-x\right)\left(x-0.1i\right)\pi^2}dx = 
				\frac{\pi^2}{60}\,,\\
			I_{2,i}& = 100\int\limits_{0.1i-0.1}^{0.1i}{
				\left(x-0.1i+0.1\right)^2\pi^2}dx = 
				\frac{\pi^2}{30}\,,\\
			I_{3,i}& = 100\int\limits_{0.1i}^{0.1i+0.1}{
				\left(0.1i+0.1-x\right)^2\pi^2}dx = 
				\frac{\pi^2}{30}\,,\\
			I_{4,i}& = 100\int\limits_{0.1i-0.1}^{0.1i}dx = 10\,,\\
			I_{5,i}& = 10\int\limits_{0.1i-0.1}^{0.1i}{
				\left(x-0.1i+0.1\right)2\pi^2\sin{\pi x}}dx = \\
			       & = -2\pi\cos{0.1\pi i} + 20\left[
			       \sin{0.1\pi i}-\sin{\left(0.1i-0.1\right)\pi}\right] \,,\\
			I_{6,i}& = 10\int\limits_{0.1i}^{0.1i+0.1}{
				\left(0.1i+0.1-x\right)2\pi^2\sin{\pi x}}dx = \\
			       & = 2\pi\cos{0.1\pi i} - 20\left[
			       \sin{\left(0.1i+0.1\right)\pi} - \sin{0.1\pi i}\right] \,.
		\end{align*}
		Диагональные элементы матрицы системы будут равны
		\begin{align*}
			a_{i,i}& 	= 20 + \frac{\pi^2}{15}\, 
				\quad i = \overline{1,9}\,,\\
			a_{i,i+1}&	= -10 + \frac{\pi^2}{60}\, 
				\quad i = \overline{1,8}\,,\\
			a_{i,i+1}&	= -10 + \frac{\pi^2}{60}\, 
				\quad i = \overline{2,9}\,,\\
				b_i&	= 40\sin{0.1\pi i}\left[1-\cos{0.1\pi}\right]\, 
				\quad i = \overline{1,9}\,.
		\end{align*}
		Решая трехдиагональную систему, получаем следующие значения
		коэффициентов:
		
		\begin{center}
			\begin{tabular}{ccc}
				$c_9=0.310287$, & $c_8=0.590200$, & $c_7=0.812341$,\\
				$c_6=0.954964$, & $c_5=1.004109$, & $c_4=0.954964$,\\
				$c_3=0.812341$, & $c_2=0.590200$, & $c_1=0.310287$.
			\end{tabular}
		\end{center}
		Итак, мы получили приближенное решение вариационной задачи в
		виде линейной комбинации
		\[
			\varphi(x) = \sum\limits_{i=1}^9{c_i\varphi_i(x)},
		\]
		в то время как точным решением является $y(x)=\sin{\pi x}$
		({\bf проверьте это!}).
		Следующая таблица демонстрирует ошибку кусочно-линейной
		аппроксимации, которая, как нетрудно заметить, имеет порядок
		$O(h^2)$.
		\begin{center}
			\setlength{\tabcolsep}{12pt}
			\begin{tabular}{ccccc}
				$i$ & $x_i$ & $\varphi(x_i)$ & $y(x_i)$ & $\left|\varphi(x_i)-y(x_i)\right|$
				\\[4pt]
				\hline
				$1$ & $0.1$ & $0.310287$ & $0.309017$ &	$0.00127$ \\
 				$2$ & $0.2$ & $0.590200$ & $0.587785$ & $0.00241$ \\
				$3$ & $0.3$ & $0.812341$ & $0.809017$ & $0.00332$ \\
				$4$ & $0.4$ & $0.954964$ & $0.951057$ & $0.00390$ \\
				$5$ & $0.5$ & $1.004108$ & $1.000000$ & $0.00411$ \\
				$6$ & $0.6$ & $0.954964$ & $0.951057$ & $0.00390$ \\
				$7$ & $0.7$ & $0.812341$ & $0.809017$ & $0.00332$ \\
				$8$ & $0.8$ & $0.590200$ & $0.587785$ & $0.00241$ \\
				$9$ & $0.9$ & $0.310287$ & $0.309017$ &	$0.00127$ \\[1pt]
				\hline
			\end{tabular}
		\end{center}
		\qed
	\end{Sol}
\subsection{Базис из B-сплайнов}
	Кусочно-линейная аппроксимация решения вариационной задачи, полученная
	в предыдущем пункте, является непрерывной, но не дифференцируемой на промежутке
	$[0,1]$. Более разумным представляется выбор базисных функций из класса 
	$C^2_{[0,1]}$. Построение простейших функций такого рода производится
	точно так же, как и построение кубических сплайнов. Напомним определение
	последних.
	\begin{Def} Кубическим интерполяционным сплайном для функции $f(x)$,
		построенным по пяти точкам $x_0, \dots, x_4$, называется функция
		$S(x)$, удовлетворяющая следующим требованиям:
		\begin{enumerate}
			\item $S(x)$ представляет собой кубический полином, обозначаемый
			$S_j(x)$, на каждом интервале $[x_j, x_{j+1}], j=0,1,2,3$;
			\item $S_j(x_j) = f(x_j)$ и $S_j(x_{j+1})=f(x_{j+1}),\, j=0,1,2,3$;
			\item $S_{j+1}(x_{j+1}) = S_j(x_{j+1}),\, j=0,1,2$;
			\item $S'_{j+1}(x_{j+1}) = S'_j(x_{j+1}),\, j=0,1,2$;
			\item $S''_{j+1}(x_{j+1}) = S''_j(x_{j+1}),\, j=0,1,2$;
			\item Выполняется один из следующих наборов граничных условий:
				\begin{enumerate}
					\item $S''(x_0) = S''(x_4) = 0$ (естественные
						условия);
					\item $S'(x_0) = f'(x_0)$ и $S'(x_4)=f'(x_4)$.
				\end{enumerate}
		\end{enumerate}
	\end{Def}
	Каждый из четырех многочленов $S_j(x)$ задается четырьмя коэффициентами, поэтому
	для определения сплайна нужно 16 параметров. Чтобы сплайн определялся единственным образом,
	нужно требовать выполнения лишь одного из условий пункта 6.

	При построении базисных функций мы будем пользоваться так называемыми B-сплайнами
	(от {\it bell-shaped splines}, т.е. колоколообразные сплайны). Они отличаются тем,
	что вместо пункта $2$ определения требуется выполнение условия $2'$:
	\[
		S(x_j) = f(x_j),\, j=0,2,4\,,
	\]
	и двух условий на концах:
	\[
		S''(x_0)=S''(x_4)=0 \quad \text{и} \quad
			S'(x_0)=S'(x_4)=0\,.
	\]
	Определим функцию $S(x) \in C^2_{(-\infty, \infty)}$ следующим образом:
	\[
		S(x)=
		\begin{cases}
			0 ,						& \text{если}\quad x \leq 2 ,\\
			\frac{1}{4}(2+x)^3 ,				& \text{если}\quad -2 < x \leq -1 ,\\
			\frac{1}{4}\left[(2+x)^3-4(1+x)^3\right] ,	& \text{если}\quad -1 < x \leq 0 ,\\
			\frac{1}{4}\left[(2-x)^3-4(1-x)^3\right] ,	& \text{если}\quad 0 < x \leq 1 ,\\
			\frac{1}{4}(2-x)^3 ,				& \text{если}\quad 1 < x \leq 2,\\
			0 ,						& \text{если}\quad x > 2.
		\end{cases}
	\]
	График ее изображен на рисунке ниже. Эта функция используется при построении
	базисных функций.
	\begin{center}
	\begin{tikzpicture}
		\begin{axis}[
			%axis equal image=true,	
			%scale=2,
			y=3cm,
			axis equal=false,
			%minor tick num=1,
			axis x line=middle,
			axis y line=middle,
			xlabel=$x$,ylabel=$y$,
			xmin=-4, xmax=4,
			ymin=0, ymax=1.25
			]
			\addplot[blue, ultra thick, domain=-4:-2] 	{0};
			\addplot[blue, ultra thick, domain=2:4] 	{0};
			\addplot[blue, ultra thick, domain=-2:-1] 	{0.25*(2+x)^3};
			\addplot[blue, ultra thick, domain=1:2] 	{0.25*(2-x)^3};
			\addplot[blue, ultra thick, domain=-1:0] 	{0.25*((2+x)^3-4*(1+x)^3)};
			\addplot[blue, ultra thick, domain=0:1] 	{0.25*((2-x)^3-4*(1-x)^3)};
			\draw (5cm, 2.75cm)  node {$y=S(x)$};
			
		\end{axis}
	\end{tikzpicture}
	\end{center}
	Разобъем промежуток $[0,1]$, задавшись натуральным $n$ и определив шаг 
	равномерного разбиения $h = \dfrac{1}{n+1}$ так, что $x_i = ih, i=\overline{0,n+1}$.
	Базисные функции опредяются следующим образом:
	\[
		\varphi_i(x)=
		\begin{dcases}
			S\left(\dfrac{x}{h}\right)-4S\left(\dfrac{x+h}{h}\right) , & 
				\text{если} \quad i=0 ,\\
			S\left(\dfrac{x-h}{h}\right)-S\left(\dfrac{x+h}{h}\right) , & 
				\text{если} \quad i=1 ,\\
			S\left(\dfrac{x-ih}{h}\right) , &
				\text{если} \quad 2 \leq i \leq n-1 ,\\
			S\left(\dfrac{x-nh}{h}\right)-S\left(\dfrac{x-(n+2)h}{h}\right) , &
				\text{если} \quad i=n ,\\
			S\left(\dfrac{x-(n+1)h}{h}\right)-4S\left(\dfrac{x-(n+2)h}{h}\right) , &
				\text{если} \quad i=n+1 .
		\end{dcases}
	\]
	Можно показать, что система функций $\left\{\varphi_i(x)\right\}_{i=0}^{n+1}$ 
	линейно независима и каждая функция удовлетворяет однородным краевым условиям.
	Ниже изображены графики пяти возможных типов базисных функций при заданном разбиении.
	\begin{center}
	\begin{tikzpicture}
		\begin{axis}[
			y=3cm, x=1.5cm,
			axis x line=left,
			axis y line=left,
			xlabel=$x$,ylabel=$y$,
			xlabel near ticks,
			ytick={1},
			xtick={1, 2, 3, 4, 5},
			xticklabels={$x_{i-2}$, $x_{i-1}$, $x_i$, $x_{i+1}$, $x_{i+2}$},
			xmin=0.0, xmax=6.5,
			ymin=0.0, ymax=1.25,
			]
			\addplot[blue, very thick, domain=1:5, samples=100] {exp(-1.5*(x-3)^2)};
			\draw (7.5cm, 2.5cm)  node {$y=\varphi_i(x),\,\, i=\overline{2,n-1}$};
		\end{axis}
	\end{tikzpicture}
	\end{center}
	
	\begin{center}
	\begin{tikzpicture}
		\begin{axis}[
			y=3cm, x=1.5cm,
			axis x line=left,
			axis y line=left,
			xlabel=$x$,ylabel=$y$,
			xlabel near ticks,
			ytick={1},
			xtick={1, 2, 3},
			xticklabels={$x_1$, $x_2$, $x_3$},
			xmin=0.0, xmax=3.5,
			ymin=0.0, ymax=1.2,
			]
			\addplot[blue, very thick, domain=0:2, samples=20] {0.5*x^3-2*x^2+2*x};
			\draw (3.2cm, 1.5cm)  node {$y=\varphi_0(x)$};
		\end{axis}
	\end{tikzpicture}
	\begin{tikzpicture}
		\begin{axis}[
			y=3cm, x=1.5cm,
			axis x line=left,
			axis y line=left,
			xlabel=$x$,ylabel=$y$,
			xlabel near ticks,
			ytick={1},
			xtick={1, 2, 3},
			xticklabels={$x_1$, $x_2$, $x_3$},
			xmin=0.0, xmax=3.5,
			ymin=0.0, ymax=1.2,
			]
			\addplot[blue, very thick, domain=0:3, samples=30] {0.25*x^3-1.5*x^2+9*x/4};
			\draw (1.5cm, 1.5cm)  node {$y=\varphi_1(x)$};
		\end{axis}
	\end{tikzpicture}
	\\
	\begin{tikzpicture}
		\begin{axis}[
			y=3cm, x=1.5cm,
			axis x line=left,
			axis y line=left,
			xlabel=$x$,ylabel=$y$,
			xlabel near ticks,
			ytick={1},
			xtick={0, 1, 2, 3},
			xticklabels={$x_{n-2}$, $x_{n-1}$, $x_n$, $1$},
			xmin=0.0, xmax=3.5,
			ymin=0.0, ymax=1.2,
			]
			\addplot[blue, very thick, domain=0:3, samples=30] {-(0.25*(x+1)^3-1.5*(x+1)^2+9*(x+1)/4-1)};
			\draw (2.8cm, 1.5cm)  node {$y=\varphi_n(x)$};
			
		\end{axis}
	\end{tikzpicture}
	\begin{tikzpicture}
		\begin{axis}[
			y=3cm, x=1.5cm,
			axis x line=left,
			axis y line=left,
			xlabel=$x$,ylabel=$y$,
			xlabel near ticks,
			ytick={1},
			xtick={1, 2, 3},
			xticklabels={$x_{n-1}$, $x_n$, $1$},
			xmin=0.0, xmax=3.5,
			ymin=0.0, ymax=1.2,
			]
			\addplot[blue, very thick, domain=1:5, samples=100] {2.35*(-0.2*x^3+x^2-7*x/5+3/5)};
			\draw (1.0cm, 1.5cm)  node {$y=\varphi_{n+1}(x)$};
		\end{axis}
	\end{tikzpicture}
	\\
	\end{center}
	Поскольку каждая функция $\varphi_i(x)$ вместе со своей производной
	$\varphi'_i(x)$ отлична от нуля только на интервале $[x_{i-2}, x_{i+2}]$,
	матрица системы для нахождения коэффициентов линейной комбинации
	имеет ленточный вид:
	\[A = \begin{pmatrix}
		a_{00} & a_{01} & a_{02} & a_{03} & 0      & \hdotsfor{3} & 0 \\	
		a_{10} & a_{11} & a_{12} & a_{13} & a_{14} & \ddots & & & \vdots \\
		a_{20} & a_{21} & a_{22} & a_{23} & a_{24} & a_{25} & \ddots & & \vdots \\
		a_{30} & a_{31} & a_{32} & a_{33} & a_{34} & a_{35} & a_{36} & \ddots & \vdots \\
		0      & \ddots & \ddots & \ddots & \ddots & \ddots & \ddots & \ddots & 0 \\ 
		\vdots & \ddots & \ddots & \ddots & \ddots & \ddots & \ddots & \ddots & a_{n-2,n+1} \\ 
		\vdots &  & \ddots & \ddots & \ddots & \ddots & \ddots & \ddots & a_{n-1,n+1} \\
		\vdots &  &  & \ddots & \ddots & \ddots & \ddots & \ddots & a_{n, n+1} \\
		0      & \hdotsfor{3}    & 0      & a_{n+1,n-2}     & a_{n+1,n-1}     & a_{n+1,n} &  a_{n+1,n+1}
	\end{pmatrix}\,,\]
	где 
	\[
		a_{ij} = \int\limits_0^1\left[
			p(x)\varphi'_i(x)\varphi'_j(x) + q(x)\varphi_i(x)\varphi_j(x)
		\right]dx\,, \quad i,j=\overline{0,n+1},
	\]
	а элементы столбца правых частей определяется как
	\[
		b_i = \int\limits_0^1f(x)\varphi_i(x)dx\,.
	\]
	Можно показать, что матрица $A$ является положительно определенной.
	Значит, систему уравнений $Ac=b$ для неизвестных коэффицентов линейной аппроксимации
	можно эффективно решить при помощи разложения Холецкого (конечно, можно
	ограничиться и обычным методом Гаусса). 

	Запишем теперь формальный алгоритм метода Ритца, использующего кубические сплайны.
	\vspace{2em}\\
	\begin{algorithm}[H]
		\DontPrintSemicolon
		\NoCaptionOfAlgo
		\SetKwInOut{Input}{ВХОД} 
		\SetKwInOut{Output}{ВЫХОД}

		\Input{Целое число $n \geq 1$.}
		\BlankLine
		\Output{Коэффициенты $c_0, \dots, c_{n+1}$.}
		\BlankLine
		\nlset{ШАГ 1}	Определим шаг $h=\dfrac{1}{n+1}$. \;
		\nlset{ШАГ 2} 	\For{$i \leftarrow 0$ \KwTo $n+1$}{
					$x_i \leftarrow ih$
				}
				$x_{-2}, x_{-1} \leftarrow 0$ \;
				$x_{n+2}, x_{n+3} \leftarrow 1$\;
		\nlset{ШАГ 3} Определим функцию $S(x)$:
				$
					S(x)=
					\begin{cases}
						0 ,						
							& \text{если}\quad x \leq 2 ,\\
						\frac{1}{4}(2+x)^3 ,				
							& \text{если}\quad -2 < x \leq -1 ,\\
						\frac{1}{4}\left[(2+x)^3-4(1+x)^3\right] ,	
							& \text{если}\quad -1 < x \leq 0 ,\\
						\frac{1}{4}\left[(2-x)^3-4(1-x)^3\right] ,	
							& \text{если}\quad 0 < x \leq 1 ,\\
						\frac{1}{4}(2-x)^3 ,				
							& \text{если}\quad 1 < x \leq 2,\\
						0 ,						
							& \text{если}\quad x > 2.
					\end{cases}
				$ \;
		\nlset{ШАГ 4}	Определяем базисные функции $\left\{\varphi_i\right\}_{i=0}{n+1}$:
					
				$\varphi_0(x)  = 
						S\left(\dfrac{x}{h}\right)-4S\left(\dfrac{x+h}{h}\right)$, \;
				$\varphi_1(x)  = 
						S\left(\dfrac{x-x_1}{h}\right)-S\left(\dfrac{x+h}{h}\right)$, \;
				\For{$i \leftarrow 2$ \KwTo $n-1$}{
					$ \varphi_i(x) = S\left(\dfrac{x-x_i}{h}\right)$
				}
				$\varphi_n(x)  = 
						S\left(\dfrac{x-x_n}{h}\right)-S\left(\dfrac{x-(n+2)h}{h}\right)$, \;
				$\varphi_{n+1}(x)  = 
						S\left(\dfrac{x-x_{n+1}}{h}\right)-4S\left(\dfrac{x-(n+2)h}{h}\right)$.
				\;
			\caption{\Large Метод Ритца, использующий кубические сплайны.}
		\end{algorithm}
		
		\begin{algorithm}[H]
			\DontPrintSemicolon
			\NoCaptionOfAlgo
			\SetKwInOut{KwPrint}{ВЫВЕСТИ}
			\SetKwFor{uuFor}{}{}{end}

		\nlset{ШАГ 5} \For{$i \leftarrow 0$ \KwTo $n+1$}{
				\nlset{5.1} \For{$j \leftarrow i$ \KwTo $\min[i+3,n+1]$}{
					$L \leftarrow \max[x_{j-2},0]$ \;
					$U \leftarrow \min[x_{j+2},1]$ \;
					$\displaystyle 
						a_{ij} = \int\limits_L^U\left[p(x)\varphi'_i(x)\varphi'_j(x) + 
						q(x)\varphi_i(x)\varphi_j(x)\right]dx$ \;
					\If{$i \neq j$}{
						$a_{ji} \leftarrow a_{ij}$
					}
				} 
				\nlset{5.2} 
					\If{$i \geq 4$}{
						\For{$j \leftarrow 0$ \KwTo $i-4$}{
							$a_{ij} \leftarrow 0$
						}
				} 
				\nlset{5.3} 
					\If{$i \leq n-3$}{
						\For{$j \leftarrow i+4$ \KwTo $n+1$}{
							$a_{ij} \leftarrow 0$
						}
				} 
				\nlset{5.4} $L \leftarrow \max[x_{i-2},0]$ \;
					    $U \leftarrow \min[x_{i+2},1]$ \;
					    $\displaystyle 
					    	b_i = \int\limits_L^Uf(x)\varphi_i(x)dx$\,.
				}
		\nlset{ШАГ 6} Решаем систему линейных уравнений $Ac=b$, где $A=(a_{ij})$,
				$b=\left(b_0, \dots, b_{n+1}\right)^T$ и 
				$c=\left(c_0, \dots, c_{n+1}\right)^T$. 
			\;
		\nlset{ШАГ 7} \For{$i \leftarrow 0$ \KwTo $n+1$}{
				\KwPrint{$c_i$}
				}
		\nlset{ШАГ 8} Процедура окончена.				

	\end{algorithm}
	\vspace{2em}
	Отметим, что численное интегрирование на шагах 5.1 и 5.4 рекомендуется
	выполнять следующим образом. Во-первых, необходимо построить интерполяционные
	кубические сплайны для функций $p(x), f(x), q(x)$. Во-вторых,
	с их помощью построить аппроксимацию подынтегральных выражений. В результате
	под знаком интеграла окажется полином, который можно легко проинтегрировать 
	на каждом из подынтервалов в явном виде.

	Рассмотрим в качестве примера применения последнего алгоритма задачу, уже
	решенную припомощи кусочно-линейной аппроксимации.
	\begin{Ex}
		Минимизировать функционал
		\[
			V[y] = \int\limits_0^1{\left(\left[y'(x)\right]^2 +
			\pi^2y^2(x) - 4\pi^2\sin{\pi x}\right)}dx\,,
		\]
		на множестве $C^2_{[0,1]}$ при заданных граничных условиях $y(0) = y(1) = 0$. 
	\end{Ex}
	\begin{Sol}
		Чтобы иметь возможность сравнить результат с предыдущим,
		положим $n=9$. Тогда мы получим значения аппроксимации решения вариационной
		задачи в тех же точках. Следующая таблица демонстрирует результаты
		применения описанного выше алгоритма.
		\begin{center}
			\setlength{\tabcolsep}{12pt}
			\begin{tabular}{cccccc}
				$i$ & $c_i$ & $x_i$ & $\varphi(x_i)$ & $y(x_i)$ & $\left|\varphi(x_i)-y(x_i)\right|$
				\\[4pt]
				\hline
				$0$   & $0.509644 \times 10^{-5}$  & $0.0$ & $0.000000$ & $0.000000$ &	$0.00000000$ \\
				$1$   & $0.209426$  & $0.1$ & $0.309016$ & $0.309017$ &	   $0.00000055$ \\
 				$2$   & $0.398356$  & $0.2$ & $0.587785$ & $0.587785$ &    $0.00000024$ \\
				$3$   & $0.548289$  & $0.3$ & $0.809017$ & $0.809017$ &    $0.00000012$ \\
				$4$   & $0.644554$  & $0.4$ & $0.951057$ & $0.951057$ &    $0.00000015$ \\
				$5$   & $0.677723$  & $0.5$ & $1.000000$ & $1.000000$ &    $0.00000020$ \\
				$6$   & $0.644554$  & $0.6$ & $0.951057$ & $0.951057$ &    $0.00000061$ \\
				$7$   & $0.548290$  & $0.7$ & $0.809017$ & $0.809017$ &    $0.00000074$ \\
				$8$   & $0.398357$  & $0.8$ & $0.587785$ & $0.587785$ &    $0.00000165$ \\
				$9$   & $0.209426$  & $0.9$ & $0.309016$ & $0.309017$ &	   $0.00000111$ \\
				$10$  & $0.749313 \times 10^{-5}$  & $1.0$ & $0.000000$ & $0.000000$ &	$0.00000000$ \\
				[1pt]
				\hline
			\end{tabular}
		\end{center}
		\qed
	\end{Sol}
	
	Можно показать, что точность аппроксимации решения вариационной задачи 
	кубическими B-сплайнами имеет порядок $O(h^4)$. Метод, конечно, можно обобщить
	и на неравномерную сетку, однако алгоритм составления системы уравнений
	при этом значительно усложняется.
\end{document}















